# Enrollment Configuration with Field Transformation Functions
# Demonstrates reusable functions for string operations, masking, formatting

pdfMerge:
  name: "enrollment-functions-demo"
  description: "Demo of reusable transformation functions in field mappings"

  # Payload enrichers
  enrichers:
    - enrollmentContext
    - coverageSummary

  # Headers and footers
  header:
    enabled: true
    height: 50
    startPage: 1
    content:
      center:
        text: "Field Transformation Functions Demo"
        font: "Helvetica-Bold"
        fontSize: 12

  footer:
    enabled: true
    height: 40
    content:
      center:
        text: "Page {current} of {total}"
        font: "Helvetica"
        fontSize: 8

  # Single section - AcroForm with transformation functions
  sections:
    - type: "acroform"
      template: "enrollment-form-base.pdf"
      name: "form-with-functions"
      fieldMapping:
        # Application Information with currency formatting
        "ApplicationNumber": "#{concat('APP-', enrollment.applicationId)}"
        "EffectiveDate": "#{formatDate(enrollment.effectiveDate, 'MMM dd, yyyy')}"
        "TotalPremium": "#{formatCurrency(productSummary.grandTotalPremium)}"
        
        # Primary Applicant - Name transformations
        "Primary_FirstName": "#{uppercase(applicants[0].firstName)}"
        "Primary_LastName": "#{uppercase(applicants[0].lastName)}"
        "Primary_DOB": "#{formatDate(applicants[0].dateOfBirth, 'MM/dd/yyyy')}"
        "Primary_Gender": "applicants[0].gender"
        
        # Masking sensitive data - use 'mask' function
        "Primary_SSN": "#{mask(applicants[0].ssn, 'XXX-XX-', 4)}"
        
        # Primary Address
        "Primary_Street": "applicants[0].mailingAddress.street"
        "Primary_City": "applicants[0].mailingAddress.city"
        "Primary_State": "applicants[0].mailingAddress.state"
        "Primary_Zip": "applicants[0].mailingAddress.zipCode"
        
        # Spouse with conditional default
        "Spouse_FirstName": "#{default(applicants[1].firstName, '')}"
        "Spouse_LastName": "#{default(applicants[1].lastName, '')}"
        "Spouse_DOB": "#{formatDate(applicants[1].dateOfBirth, 'MM/dd/yyyy')}"
        
        # Dependent 1 with lowercase transformation
        "Dependent1_FirstName": "#{lowercase(applicants[2].firstName)}"
        "Dependent1_LastName": "#{lowercase(applicants[2].lastName)}"
        "Dependent1_DOB": "applicants[2].dateOfBirth"
        "Dependent1_Gender": "applicants[2].gender"
        
        # Dependent 2
        "Dependent2_FirstName": "applicants[3].firstName"
        "Dependent2_LastName": "applicants[3].lastName"
        "Dependent2_DOB": "applicants[3].dateOfBirth"
        "Dependent2_Gender": "applicants[3].gender"
